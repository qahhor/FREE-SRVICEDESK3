<div class="team-form-container">
  <div class="header">
    <button mat-icon-button (click)="cancel()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h1>{{ isEditMode() ? 'Edit Team' : 'New Team' }}</h1>
  </div>

  @if (loading()) {
    <div class="loading-spinner">
      <mat-spinner></mat-spinner>
    </div>
  } @else {
    <mat-card>
      <mat-card-content>
        <form [formGroup]="teamForm" (ngSubmit)="onSubmit()">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Team Name</mat-label>
            <input matInput formControlName="name" placeholder="Enter team name">
            @if (teamForm.get('name')?.invalid && teamForm.get('name')?.touched) {
              <mat-error>Team name is required (min 2 characters)</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description" placeholder="Enter team description" rows="3"></textarea>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Team Lead</mat-label>
            <mat-select formControlName="managerId">
              <mat-option [value]="null">No lead assigned</mat-option>
              @for (user of users(); track user.id) {
                <mat-option [value]="user.id">{{ user.fullName }} ({{ user.email }})</mat-option>
              }
            </mat-select>
            <mat-hint>Select a user to be the team lead</mat-hint>
          </mat-form-field>

          <div class="toggle-field">
            <mat-slide-toggle formControlName="active">Active</mat-slide-toggle>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button mat-button type="button" (click)="cancel()">
              Cancel
            </button>
            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="saving() || teamForm.invalid">
              @if (saving()) {
                <mat-spinner diameter="20"></mat-spinner>
              } @else {
                {{ isEditMode() ? 'Update Team' : 'Create Team' }}
              }
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  }
</div>
